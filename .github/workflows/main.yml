name: Deploy Static Site to Droplet via SSH

# Triggers the workflow on pushes to the main branch
on:
  push:
    branches:
      - main 
  # Allows manual triggering from the GitHub Actions tab
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4

      # ----------------------------------------------------
      # Step 1: Deploy Static Files using SCP
      # ----------------------------------------------------
      - name: üöÄ SCP Deploy via SSH
        # We continue to use v0.1.7 since that's what was in the logs, 
        # but the 'exclude' parameter is REMOVED to fix the warning.
        uses: appleboy/scp-action@v0.1.7 
        with:
          # SSH connection details from GitHub Secrets
          host: ${{ secrets.DROPLET_IP }}
          username: ${{ secrets.DROPLET_USER }}
          key: ${{ secrets.DROPLET_SSH_KEY }} # CRITICAL: Ensure this secret is formatted correctly
          port: 22
          
          # Deployment configuration
          source: "." # Copy all files from the root of the repository
          # IMPORTANT: Update this path to your web server's root directory (e.g., /var/www/html)
          target: "/var/www/aimak" 
          
      # ----------------------------------------------------
      # Step 2: Clear Cache / Restart Web Server (Recommended)
      # ----------------------------------------------------
      # This step ensures your web server picks up the new files.
      - name: Restart Web Server (Nginx Example)
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.DROPLET_IP }}
          username: ${{ secrets.DROPLET_USER }}
          key: ${{ secrets.DROPLET_SSH_KEY }}
          # Command to run on the Droplet
          script: |
            # Only required if your server is running Nginx/Apache
            sudo systemctl restart nginx
            # OR for Apache: sudo systemctl restart apache2
